# ---------------------------------------------------------------------------
# GRPC Server settings
# It configures the address, settings for gRPC, TLS config 
# and crypto material of the node.
# ---------------------------------------------------------------------------
General:
  # The IP on which to bind to listen.
  ListenAddress: 0.0.0.0
  # The port on which to bind to listen.
  ListenPort: {{ orderer_rpc_port }}
  # The TLS settings for the GRPC server.
  TLS:
    # Require server-side TLS
    Enabled: {{ orderer_use_tls | bool | lower }}
    # The file location of the private key of the server TLS certificate.
    PrivateKey: {{ orderer_config_dir }}/tls/server.key
    # The file location of the server TLS certificate.
    Certificate: {{ orderer_config_dir }}/tls/server.crt
    # A list of additional file locations for root certificates used for verifying certificates of other nodes during outbound connections.
    RootCAs:
      - {{ orderer_config_dir }}/tls/ca.crt
    # Require client certificates / mutual TLS for inbound connections
    ClientAuthRequired: {{ orderer_use_mtls | bool | lower }}
{% if orderer_use_mtls %}
    # A list of additional root certificates used for verifying certificates of client connections.
    ClientRootCAs:
{% if orderer_mtls_clients is defined %}
{% for orderer_mtls_client in orderer_mtls_clients %}
      - {{ orderer_config_dir }}/mtls/{{ orderer_mtls_client }}/ca.crt
{% endfor %}
{% endif %}
{% endif %}
  # The Keepalive settings for the GRPC server.
  Keepalive:
    # The duration after which if the client does not see any activity 
    # from the server it pings the server to see if it is alive.
    ClientInterval: 1m0s
    # The duration the client waits for a response from the server
    # after sending a ping before closing the connection.
    ClientTimeout: 20s
    # The duration after which if the server does not see any activity 
    # from the client it pings the client to see if it is alive.
    ServerInterval: 2h0m0s
    # The duration the server waits for a response  from the client
    # after sending a ping before closing the connection.
    ServerTimeout: 20s
    # The minimum permitted time between client pings.
    # If clients send pings more frequently, the server will disconnect them.
    ServerMinInterval: 1m0s
  # The configuration options for GRPC client.
  Backoff:
    # The amount of time to backoff after the first failure.
    BaseDelay: 1s
    # The factor with which to multiply backoffs after a
    # failed retry. Should ideally be greater than 1.
    Multiplier: 1.6
    # The upper bound of backoff delay.
    MaxDelay: 2m0s
  # Max message size in bytes the GRPC server and client can receive.
  MaxRecvMsgSize: 104857600
  # Max message size in bytes the GRPC server and client can send.
  MaxSendMsgSize: 104857600
  # Indicates the method by which to obtain the bootstrap configuration and the file containing the bootstrap configuration.
  Bootstrap:
    # Specify the method by which to obtain the bootstrap configuration.
    # The option can be one of:
    #  1. "block" - path to a file containing the genesis block or config block
    #  2. "yaml" - path to a file containing a YAML boostrap configuration (i.e. ./shared_config.yaml).
    Method: block
    # The path for the bootstrap configuration.
    # The bootstrap file can be the genesis block, and it can also be a config block for late bootstrap.
    File: {{ orderer_config_dir }}/genesis.block
  # Defines the settings for ordering service nodes that communicate with other ordering service nodes.    
  Cluster:
    # The maximum number of messages in the egress buffer.
    # Consensus messages are dropped if the buffer is full, and transaction 
    # messages are waiting for space to be freed.
    SendBufferSize: 2000
    # The file location of the client TLS certificate used to establish mutual TLS connections
    # with other ordering service nodes.
    # If not set, the server General.TLS.Certificate is re-used.    
    ClientCertificate: {{ orderer_config_dir }}/tls/server.crt
    # The file location of the private key of the client TLS certificate.
    # If not set, the server General.TLS.PrivateKey is re-used.    
    ClientPrivateKey: {{ orderer_config_dir }}/tls/server.key
  # The path to the private crypto material needed by the Fabric-X Orderer.
  LocalMSPDir: {{ orderer_config_dir }}/msp
  # The identity to register the local MSP material with the MSP manager.
  LocalMSPID: {{ organization.name }}
  # The logging level of the node
  LogSpec: info
