#
# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

- name: Set given client as container client
  ansible.builtin.set_fact:
    container_client: "{{ container_client }}"
  when:
    - container_client != ''

- name: Check if podman is installed
  ansible.builtin.shell:
    cmd: "command -v podman > /dev/null 2>&1"
  register: container_check_podman
  ignore_errors: true
  changed_when: false
  failed_when: false
  when:
    - container_client == ''

- name: Check if docker is installed
  ansible.builtin.shell:
    cmd: "command -v docker > /dev/null 2>&1"
  register: container_check_docker
  ignore_errors: true
  changed_when: false
  failed_when: false
  when:
    - container_client == ''
    - container_check_podman.rc != 0

- name: Set podman as container client
  ansible.builtin.set_fact:
    container_client: "podman"
  when:
    - container_client == ''
    - container_check_podman.rc == 0

- name: Set docker as container client
  ansible.builtin.set_fact:
    container_client: "docker"
  when:
    - container_client == ''
    - container_check_podman.rc != 0
    - container_check_docker.rc == 0
