#
# Copyright IBM Corp. All Rights Reserved.
#
# SPDX-License-Identifier: Apache-2.0
#

# This inventory runs an Hyperledger Fabric-X network by generating the crypto material directly on the remote
# nodes using "Fabric CA".
# This approach allows to generate the private key directly on the remote node, which is the safest approach.
# All the services run as containers, therefore make sure to have a container engine installed on
# your target machines (Docker or Podman).

all:
  vars:
    # =========================
    # Organizations
    # =========================
    organizations:
      orderer_org_1: &OrdererOrg1
        name: OrdererOrg1
        domain: ordererorg1.example.com
      orderer_org_2: &OrdererOrg2
        name: OrdererOrg2
        domain: ordererorg2.example.com
      orderer_org_3: &OrdererOrg3
        name: OrdererOrg3
        domain: ordererorg3.example.com
      orderer_org_4: &OrdererOrg4
        name: OrdererOrg4
        domain: ordererorg4.example.com
      org1: &Org1
        name: Org1
        domain: org1.example.com
    # TODO: temporary patch to use fxconfig as bin until we release the image
    fxconfig_use_bin: true
  children:
    # =========================
    # Network (HLFX)
    # =========================
    network:
      children:
        # =========================
        # Hyperledger Fabric CAs
        # =========================
        fabric_cas:
          children:
            # =========================
            # Hyperledger Fabric CA DBs
            # =========================
            fabric_ca_dbs:
              vars:
                postgres_user: postgres
                postgres_password: example
                postgres_use_tls: true
              hosts:
                fca-orderer-org1-db:
                  postgres_db: ordererOrg1DB
                  postgres_port: 9120
                fca-orderer-org2-db:
                  postgres_db: ordererOrg2DB
                  postgres_port: 9130
                fca-orderer-org3-db:
                  postgres_db: ordererOrg3DB
                  postgres_port: 9140
                fca-orderer-org4-db:
                  postgres_db: ordererOrg4DB
                  postgres_port: 9150
                fca-org1-db:
                  postgres_db: Org1DB
                  postgres_port: 9170
            # =========================
            # Hyperledger Fabric CA Servers
            # =========================
            fabric_ca_servers:
              vars:
                fabric_ca_use_tls: true
                fabric_ca_name: "{{ inventory_hostname }}"
                fabric_ca_admin:
                  name: admin
                  secret: adminPWD
                  attrs:
                    hf.Registrar.Roles: "*"
                    hf.Registrar.Attributes: "*"
                    hf.GenCRL: "true"
                    hf.Revoker: "true"
              hosts:
                fabric-ca-orderer-org1:
                  fabric_ca_port: 9019
                  fabric_ca_operations_port: 9020
                  organization: *OrdererOrg1
                  postgres_db_host: fca-orderer-org1-db
                fabric-ca-orderer-org2:
                  fabric_ca_port: 9029
                  fabric_ca_operations_port: 9030
                  organization: *OrdererOrg2
                  postgres_db_host: fca-orderer-org2-db
                fabric-ca-orderer-org3:
                  fabric_ca_port: 9039
                  fabric_ca_operations_port: 9040
                  organization: *OrdererOrg3
                  postgres_db_host: fca-orderer-org3-db
                fabric-ca-orderer-org4:
                  fabric_ca_port: 9049
                  fabric_ca_operations_port: 9050
                  organization: *OrdererOrg4
                  postgres_db_host: fca-orderer-org4-db
                fabric-ca-org1:
                  fabric_ca_port: 9069
                  fabric_ca_operations_port: 9070
                  organization: *Org1
                  postgres_db_host: fca-org1-db

        # =========================
        # Hyperledger Fabric-X
        # =========================
        fabric_x:
          children:
            # =========================
            # HLFX Orderers
            # =========================
            fabric_x_orderers:
              vars:
                orderer_use_tls: true
              children:
                fabric_x_orderer_1:
                  vars:
                    organization:
                      <<: *OrdererOrg1
                      fabric_ca_host: fabric-ca-orderer-org1
                      role: orderer
                      orderer:
                        name: "{{ inventory_hostname }}"
                        secret: "{{ inventory_hostname }}PWD"
                    orderer_group: 1
                  hosts:
                    orderer-router-1:
                      orderer_component_type: router
                      orderer_rpc_port: 7050
                    orderer-batcher-1:
                      orderer_shard_id: 1
                      orderer_component_type: batcher
                      orderer_rpc_port: 7051
                    orderer-consenter-1:
                      orderer_component_type: consenter
                      orderer_rpc_port: 7052
                    orderer-assembler-1:
                      orderer_component_type: assembler
                      orderer_rpc_port: 7053
                fabric_x_orderer_2:
                  vars:
                    organization:
                      <<: *OrdererOrg2
                      fabric_ca_host: fabric-ca-orderer-org2
                      role: orderer
                      orderer:
                        name: "{{ inventory_hostname }}"
                        secret: "{{ inventory_hostname }}PWD"
                    orderer_group: 2
                  hosts:
                    orderer-router-2:
                      orderer_component_type: router
                      orderer_rpc_port: 7150
                    orderer-batcher-2:
                      orderer_shard_id: 1
                      orderer_component_type: batcher
                      orderer_rpc_port: 7151
                    orderer-consenter-2:
                      orderer_component_type: consenter
                      orderer_rpc_port: 7152
                    orderer-assembler-2:
                      orderer_component_type: assembler
                      orderer_rpc_port: 7153
                fabric_x_orderer_3:
                  vars:
                    organization:
                      <<: *OrdererOrg3
                      fabric_ca_host: fabric-ca-orderer-org3
                      role: orderer
                      orderer:
                        name: "{{ inventory_hostname }}"
                        secret: "{{ inventory_hostname }}PWD"
                    orderer_group: 3
                  hosts:
                    orderer-router-3:
                      orderer_component_type: router
                      orderer_rpc_port: 7250
                    orderer-batcher-3:
                      orderer_shard_id: 1
                      orderer_component_type: batcher
                      orderer_rpc_port: 7251
                    orderer-consenter-3:
                      orderer_component_type: consenter
                      orderer_rpc_port: 7252
                    orderer-assembler-3:
                      orderer_component_type: assembler
                      orderer_rpc_port: 7253
                fabric_x_orderer_4:
                  vars:
                    organization:
                      <<: *OrdererOrg4
                      fabric_ca_host: fabric-ca-orderer-org4
                      role: orderer
                      orderer:
                        name: "{{ inventory_hostname }}"
                        secret: "{{ inventory_hostname }}PWD"
                    orderer_group: 4
                  hosts:
                    orderer-router-4:
                      orderer_component_type: router
                      orderer_rpc_port: 7350
                    orderer-batcher-4:
                      orderer_shard_id: 1
                      orderer_component_type: batcher
                      orderer_rpc_port: 7351
                    orderer-consenter-4:
                      orderer_component_type: consenter
                      orderer_rpc_port: 7352
                    orderer-assembler-4:
                      orderer_component_type: assembler
                      orderer_rpc_port: 7353

            # =========================
            # HLFX Committer
            # =========================
            fabric_x_committer:
              vars:
                committer_use_tls: true
                organization:
                  <<: *Org1
                  fabric_ca_host: fabric-ca-org1
                  role: peer
                  peer:
                    name: "{{ inventory_hostname }}"
                    secret: "{{ inventory_hostname }}PWD"
              hosts:
                committer-db:
                  postgres_user: sc_user
                  postgres_password: sc_secret_pwd
                  postgres_db: sc_db
                  postgres_port: 5435
                  postgres_use_tls: true
                committer-validator:
                  committer_component_type: validator
                  committer_rpc_port: 5100
                  prometheus_exporter_port: 2120
                  postgres_db_host: committer-db
                committer-verifier:
                  committer_component_type: verifier
                  committer_rpc_port: 5200
                  prometheus_exporter_port: 2130
                committer-coordinator:
                  committer_component_type: coordinator
                  committer_rpc_port: 5300
                  prometheus_exporter_port: 2140
                committer-sidecar:
                  committer_component_type: sidecar
                  committer_rpc_port: 5400
                  prometheus_exporter_port: 2150
                committer-query-service:
                  committer_component_type: query-service
                  committer_rpc_port: 5500
                  prometheus_exporter_port: 2160
                  postgres_db_host: committer-db

    # =========================
    # HLFX LoadGens
    # =========================
    load_generators:
      hosts:
        orderer-loadgen:
          organization:
            <<: *Org1
            fabric_ca_host: fabric-ca-org1
            users:
              - name: orderer-loadgen
                secret: "{{ inventory_hostname }}PWD"
                namespace: 0
                meta_namespace_admin: true
          loadgen_type: orderer-client
          prometheus_exporter_port: 2119
          loadgen_web_port: 6997

    # =========================
    # Monitoring Infra
    # =========================
    monitoring:
      hosts:
        node-exporter:
          node_exporter_port: 9111
          node_exporter_use_tls: true
        committer-db-exporter:
          postgres_db_host: committer-db
          postgres_exporter_port: 2110
          postgres_exporter_use_tls: true
        prometheus:
          prometheus_port: 9090
          prometheus_use_tls: true
        grafana:
          grafana_username: admin
          grafana_password: adminPWD
          grafana_web_port: 3000
          prometheus_host: prometheus
          grafana_use_tls: true
